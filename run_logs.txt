[0;34m🚀 Starting Runtime Application (host mode)...[0m

[0;34mRunning setup checks...[0m
[0;34m🚀 Setting up Runtime Application (local mode)...[0m

[0;32m✅ Project root: /workspaces/pybase[0m
[0;34mChecking Python installation...[0m
[0;32m✅ Python 3.12 detected[0m

[0;34mChecking uv package manager...[0m
[0;32m✅ uv is available: uv 0.9.3[0m

[0;34mSetting up virtual environment...[0m
[0;32m✅ Virtual environment already exists[0m

[0;34mInstalling Emmett framework and dependencies...[0m
[0;32m✅ Dependencies installed[0m

[0;34mSetting up database...[0m
Applying migrations...
✅ DatabaseManager initialized: sqlite://bloggy.db
   Pool size: 0 (test mode: False)
✗ Error tracking unavailable: emmett-sentry not installed
✓ Prometheus metrics enabled at /metrics (pipeline-based)
✅ Registered 8 models with database
INFO: Starting automatic route discovery...
DEBUG: Found 1 BaseModel subclasses
DEBUG: Models: ['Role']
INFO: Scanning 1 BaseModel subclasses for auto_routes...
DEBUG: Checking Role
DEBUG: Role - auto_routes = {'enabled': True, 'rest_api': False}
✓ Discovered auto_routes model: Role
INFO: Discovered 1 models with auto_routes
INFO: Found 1 models with auto_routes enabled: ['Role']
INFO: Generating routes for Role at /roles
✓ Successfully registered routes for Role
✓ Automatic route generation enabled
✓ Prometheus metrics enabled at /metrics (pipeline integration)
✓ Metrics tracked automatically for all requests via pipeline
> Performing upgrades against sqlite://bloggy.db
[0;32m✅ Migrations applied[0m

[0;34mSetting up admin user...[0m
✅ DatabaseManager initialized: sqlite://bloggy.db
   Pool size: 0 (test mode: False)
✗ Error tracking unavailable: emmett-sentry not installed
✓ Prometheus metrics enabled at /metrics (pipeline-based)
✅ Registered 8 models with database
INFO: Starting automatic route discovery...
DEBUG: Found 1 BaseModel subclasses
DEBUG: Models: ['Role']
INFO: Scanning 1 BaseModel subclasses for auto_routes...
DEBUG: Checking Role
DEBUG: Role - auto_routes = {'enabled': True, 'rest_api': False}
✓ Discovered auto_routes model: Role
INFO: Discovered 1 models with auto_routes
INFO: Found 1 models with auto_routes enabled: ['Role']
INFO: Generating routes for Role at /roles
✓ Successfully registered routes for Role
✓ Automatic route generation enabled
✓ Prometheus metrics enabled at /metrics (pipeline integration)
✓ Metrics tracked automatically for all requests via pipeline
Admin user already exists!

============================================================
🔐 Setting up Role-Based Access Control System
============================================================

============================================================
🌱 SEEDING ROLE-BASED ACCESS CONTROL SYSTEM
============================================================
🌱 Seeding permissions...
  ✓ Permission exists: user.read
  ✓ Permission exists: user.create
  ✓ Permission exists: user.edit.own
  ✓ Permission exists: user.edit.any
  ✓ Permission exists: user.delete.own
  ✓ Permission exists: user.delete.any
  ✓ Permission exists: user.manage
  ✓ Permission exists: post.read
  ✓ Permission exists: post.create
  ✓ Permission exists: post.edit.own
  ✓ Permission exists: post.edit.any
  ✓ Permission exists: post.delete.own
  ✓ Permission exists: post.delete.any
  ✓ Permission exists: post.publish
  ✓ Permission exists: comment.read
  ✓ Permission exists: comment.create
  ✓ Permission exists: comment.edit.own
  ✓ Permission exists: comment.edit.any
  ✓ Permission exists: comment.delete.own
  ✓ Permission exists: comment.delete.any
  ✓ Permission exists: comment.moderate
  ✓ Permission exists: role.read
  ✓ Permission exists: role.create
  ✓ Permission exists: role.edit
  ✓ Permission exists: role.delete
  ✓ Permission exists: role.assign
  ✓ Permission exists: permission.read
  ✓ Permission exists: permission.create
  ✓ Permission exists: permission.edit
  ✓ Permission exists: permission.delete
  ✓ Permission exists: permission.assign
✅ Seeded 31 permissions

🌱 Seeding roles...
  ✓ Role exists: admin
    → Assigned ALL permissions to admin
  ✓ Role exists: moderator
  ✓ Role exists: author
  ✓ Role exists: viewer
✅ Seeded 4 roles
✓ User 1 already has admin role

============================================================
✅ ROLE SYSTEM SEEDING COMPLETE
============================================================

✅ Role system setup complete!
   - Created 31 permissions
   - Created 4 roles
   - Assigned Admin role to 1
Admin user created: doc@emmettbrown.com
[0;32m✅ Admin user created[0m

[0;32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m
[0;32m🎉 Local Setup Complete![0m
[0;32m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[0m

[0;34m📋 Next steps:[0m

1️⃣  Start the application:
   [1;33m./run_bloggy.sh --local[0m
   Or:
   [1;33mjust runtime-local[0m
   Or manually:
   [1;33mcd runtime && uv run emmett develop[0m

2️⃣  Access the application:
   • Application: http://localhost:8000/
   • Login with:
     - Email: doc@emmettbrown.com
     - Password: fluxcapacitor

3️⃣  Run tests (coverage enabled by default):
   [1;33m./run_tests.sh[0m
   Or manually:
   [1;33mcd runtime && uv run pytest tests.py[0m

[0;34m📚 About the Runtime Application:[0m
   This is a micro-blogging application built with Emmett framework.
   It demonstrates:
   • User authentication and authorization
   • Database models and ORM
   • Form handling and validation
   • Template rendering
   • Admin-only features

[0;34m📖 Emmett Documentation:[0m
   See emmett_documentation/ for comprehensive framework docs

[0;32mHappy coding! 📝[0m


[0;34mValidating Emmett models...[0m
✅ DatabaseManager initialized: sqlite://bloggy.db
   Pool size: 0 (test mode: True)
✗ Error tracking unavailable: emmett-sentry not installed
✓ Prometheus metrics enabled at /metrics (pipeline-based)
✅ Registered 8 models with database
INFO: Starting automatic route discovery...
DEBUG: Found 1 BaseModel subclasses
DEBUG: Models: ['Role']
INFO: Scanning 1 BaseModel subclasses for auto_routes...
DEBUG: Checking Role
DEBUG: Role - auto_routes = {'enabled': True, 'rest_api': False}
✓ Discovered auto_routes model: Role
INFO: Discovered 1 models with auto_routes
INFO: Found 1 models with auto_routes enabled: ['Role']
INFO: Generating routes for Role at /roles
✓ Successfully registered routes for Role
✓ Automatic route generation enabled
✓ Prometheus metrics enabled at /metrics (pipeline integration)
✓ Metrics tracked automatically for all requests via pipeline
================================================================================
Emmett Model Pattern Validation Results
================================================================================

Models checked: 3
Total violations: 7
  ✗ Errors: 0
  ⚠ Warnings: 7
  ℹ Info: 0

⚠ User: PASS WITH WARNINGS
   Found 7 violation(s): 0 errors, 7 warnings, 0 info

   [SESSION_ACCESS]
     ⚠ User (line 86)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 87)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 88)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 116)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 117)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 267)
        Models should not directly access session
        → Pass user/data as method parameters instead
     ⚠ User (line 269)
        Models should not directly access session
        → Pass user/data as method parameters instead

✓ Post: PASS (no violations)
✓ Comment: PASS (no violations)

⚠ Validation passed with 7 warning(s)
[0;32m✅ Model validation passed[0m

[0;34mBuilding Tailwind CSS...[0m

> bloggy@1.0.0 build:css
> npx @tailwindcss/cli -i ./static/input.css -o ./static/tailwind.css --minify

[0;32m✅ Tailwind CSS built successfully[0m

[0;32m✅ Setup complete! Starting development server...[0m

Access the application at: \033[0;32mhttp://localhost:8000\033[0m

Login with:
  Email: \033[1;33mdoc@emmettbrown.com\033[0m
  Password: \033[1;33mfluxcapacitor\033[0m

[0;34mPress Ctrl+C to stop the server[0m

> Starting Emmett development server on app app
> Emmett application app running on http://127.0.0.1:8000 (press CTRL+C to quit)
> Restarting (stat mode)
✅ DatabaseManager initialized: sqlite://bloggy.db
   Pool size: 0 (test mode: False)
✗ Error tracking unavailable: emmett-sentry not installed
✓ Prometheus metrics enabled at /metrics (pipeline-based)
✅ Registered 8 models with database
INFO: Starting automatic route discovery...
DEBUG: Found 1 BaseModel subclasses
DEBUG: Models: ['Role']
INFO: Scanning 1 BaseModel subclasses for auto_routes...
DEBUG: Checking Role
DEBUG: Role - auto_routes = {'enabled': True, 'rest_api': False}
✓ Discovered auto_routes model: Role
INFO: Discovered 1 models with auto_routes
INFO: Found 1 models with auto_routes enabled: ['Role']
INFO: Generating routes for Role at /roles
✓ Successfully registered routes for Role
✓ Automatic route generation enabled
✓ Prometheus metrics enabled at /metrics (pipeline integration)
✓ Metrics tracked automatically for all requests via pipeline
[INFO] Starting granian (main PID: 86845)
[INFO] Listening at: http://127.0.0.1:8000
[INFO] Spawning worker-1 with PID: 86846
[INFO] Started worker-1
[INFO] Started worker-1 runtime-1
[INFO] Shutting down granian
[INFO] Stopping worker-1
[INFO] Stopping worker-1 runtime-1
